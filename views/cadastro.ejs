<%- include('partials/header') %>
<%- include('partials/navbar') %>
<link rel="stylesheet" href="css/cadastro.css">
<body>
    <div class="container col-9">
        <div id="iner" class="card card-header"> 
            <h3 style="color: #fff; font-weight: 600;">Cadastro</h3>
            <div class="" style="display: flex; justify-content: center;">
                <i class="bi bi-person fs-1" style="color: #fff;"></i>
            </div>
        </div>
            <div class="card card-body needs-validation">
                <form method="POST" action="/cadastro/save" class="row g-3 form-contato" onsubmit="validate(event, this)">
                    <div class="col-md-6">
                        <label for="inputNome" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="inputNome" placeholder="nome completo..." name="nome">
                      </div>
                    <div class="col-md-6">
                      <label for="inputEmail4" class="form-label">Email</label>
                      <input type="email" class="form-control" id="inputEmail" placeholder="ex: abc@gmail.com" name="email">
                    </div>
                    <div class="col-md-6">
                      <label for="inputPassword4" class="form-label">Senha</label>
                      <input type="password" class="form-control" id="inputPassword" placeholder="senha..." name="senha">
                    </div>
                      <div class="col-md-6">
                        <label for="inputPassword4" class="form-label">Confirmar senha</label>
                        <input type="password" class="form-control" id="inputPasswordConfirm" placeholder="confirmar senha..." name="confirmSenha">
                      </div>
                      <div class="col-md-6">
                        <label for="inputPassword4" class="form-label">CNPJ</label>
                        <input type="text" class="form-control" id="cnpj" placeholder="campo voltado para instituições de ensino" name="cnpj">
                      </div>
                      <div class="col-md-6">
                        <label for="inputPassword4" class="form-label">Matricula</label>
                        <input type="text" class="form-control" id="matricula" placeholder="ccampo voltado para instituições de ensino" name="matricula">
                      </div>
                    <div class="col-12">
                      <label for="inputAddress" class="form-label">CEP</label>
                      <input type="text" class="form-control" id="inputAddress" placeholder="CEP : XXXXX-XXX" name="endereco">
                    </div>
                    
                    <div class="col-md-6">
                      <label for="address" class="form-label">Rua</label>
                      <input type="text" class="form-control" id="address" name="address">
                    </div>
                    <div class="col-md-6">
                      <label for="district" class="form-label">Bairro</label>
                      <input type="text" class="form-control" id="district" name="district">
                    </div>
                    <div class="col-md-6">
                      <label for="inputCity" class="form-label">Cidade</label>
                      <input type="text" class="form-control" id="inputCity" name="cidade">
                    </div>
                    <div class="col-md-6">
                      <label for="inputState" class="form-label">Estado</label>
                      <select name="estado" id="inputState" class="form-select">
                        <option selected>Estado...</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                        <option value="EX">Estrangeiro</option>    
                      </select>
                    </div>
                    
                    <div class="col-md-4">
                      <label for="inputZip" class="form-label">CPF</label>
                      <input name="cpf" type="text" class="form-control" id="inputZip">
                    </div>

                    <div class="col-md-4">
                      <label for="inputZip" class="form-label">CFP</label>
                      <input name="cfp" type="text" class="form-control" id="inputZip" placeholder="psicólogo">
                    </div>

                    <div class="col-md-4">
                      <label for="inputZip" class="form-label">CRM</label>
                      <input name="crm" type="text" class="form-control" id="inputZip" placeholder="psiquiátra">
                    </div>

                    <div class="col-12">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="gridCheck">
                        <label class="form-check-label" for="gridCheck">
                          Concordo com os termos -
                          <a style="font-size: 13px;" href="https://www.gov.br/mme/pt-br/servicos/TermodeDeclaraodeConcordnciaeVeracidade.pdf">Termo</a>
                        </label>
                      </div>
                    </div>
                    <div class="d-grid gap-2 col-6 mx-auto">
                      <button type="submit" class="btn btn-primary">Cadastrar</button>
                    </div>
                    <div class="alert alert-danger d-none">
                        Preencha o campo <span id="campo-erro"></span>!
                    </div>

                    <div>
                      <a class="btn btn-dark btn-sm text-white" href="/">Voltar</a>
                  </div>
                  </form>
                <br>
        </div>
    </div>
    <hr>
</body>
<script>
    
    function validate(event, form) {
        event.preventDefault();
        const nome = document.querySelector('#inputNome');
        const email = document.querySelector('#inputEmail');
        const senha = document.querySelector('#inputPassword');
        const confirmSenha = document.querySelector('#inputPasswordConfirm');
        const enderco = document.querySelector('#inputAddress');
        const cidade = document.querySelector('#inputCity');
        const estado = document.querySelector('#inputState');
        const checkbox = document.querySelector('#gridCheck');
        const cpf = document.querySelector('#inputZip');
        const erro = document.querySelector('.alert');
        const campo = document.querySelector('#campo-erro');

        erro.classList.add('d-none');
        nome.classList.remove('is-invalid');
        email.classList.remove('is-invalid');
        senha.classList.remove('is-invalid');
        confirmSenha.classList.remove('is-invalid');
        enderco.classList.remove('is-invalid');
        cidade.classList.remove('is-invalid');
        estado.classList.remove('is-invalid');
        checkbox.classList.remove('is-invalid');
        cpf.classList.remove('is-invalid');

        if(nome.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'nome';
            nome.focus();
            nome.classList.add('is-invalid')
            return false;
        }

        if(email.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'e-mail';
            email.focus();
            email.classList.add('is-invalid')
            return false;
        }

        if(senha.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'senha';
            senha.focus();
            senha.classList.add('is-invalid')
            return false;
        }

        if(confirmSenha.value == '' && confirmSenha != senha) {
            erro.classList.remove('d-none');
            campo.innerHTML = 'confirmar senha';
            confirmSenha.focus();
            confirmSenha.classList.add('is-invalid')
            return false;
        }

        if(enderco.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'enderço';
            enderco.focus();
            enderco.classList.add('is-invalid')
            return false;
        }

        if(cidade.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'cidade';
            cidade.focus();
            cidade.classList.add('is-invalid')
            return false;
        }

        if(estado.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'estado';
            estado.focus();
            estado.classList.add('is-invalid')
            return false;
        }

        if(checkbox.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'confirme o cadastro';
            checkbox.focus();
            checkbox.classList.add('is-invalid')
            return false;
        }

        if(cpf.value == '') {
            erro.classList.remove('d-none');
            campo.innerHTML = 'cpf';
            cpf.focus();
            cpf.classList.add('is-invalid')
            return false;
        }

        let input = document.querySelectorAll('input')
        input.forEach(inputs => {
            if(inputs !== '') {
                form.submit();
                return true;
            }
        })
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const el = document.getElementById('inputAddress')
      el.addEventListener("keyup", get);
      async function get(){
        let cep = document.getElementById('inputAddress').value
        if (cep.length == 9) {
          const getvalues = await axios.get(`https://ws.apicep.com/cep/${cep}.json`).then(res=>{return res;})    
          set(getvalues,cep)
        } else {
          
        } 
      }
      function set(res,cep){
        document.getElementById('inputCity').value = res.data.city
        document.getElementById('inputState').value = res.data.state
        document.getElementById('district').value = res.data.district
        document.getElementById('address').value = res.data.address
      }
        
    </script>

</html>